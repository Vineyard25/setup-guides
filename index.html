<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,viewport-fit=cover"
    />
    <title>Tech Setup Checklist · Vineyard25 @ Edgbarrow</title>

    <!-- React / Babel / Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: [
                'system-ui',
                '-apple-system',
                'BlinkMacSystemFont',
                '"Segoe UI"',
                'Roboto',
                'sans-serif',
              ],
            },
            colors: {
              grape: {
                50: '#f5f3f7',
                100: '#ebe8ef',
                200: '#d4cfe0',
                300: '#b5aac8',
                400: '#9583ab',
                500: '#7a6590',
                600: '#655177',
                700: '#534461',
              },
              ocean: {
                50: '#f0f5f5',
                100: '#e0ebeb',
                200: '#c1d7d9',
                300: '#99bcc0',
                400: '#6d9da3',
                500: '#528189',
                600: '#416871',
                700: '#37555c',
              },
            },
          },
        },
      };
    </script>

    <style>
      * {
        -webkit-tap-highlight-color: transparent;
      }

      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }

      @keyframes scaleIn {
        from {
          opacity: 0;
          transform: scale(0.95);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .animate-fade-in {
        animation: fadeIn 0.2s ease-out;
      }

      .animate-scale-in {
        animation: scaleIn 0.3s cubic-bezier(0.16, 1, 0.3, 1);
      }

      .animate-slide-up {
        animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      }

      .glassmorphism {
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
      }

      .glassmorphism-dark {
        background: rgba(0, 0, 0, 0.75);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
      }

      @supports (padding: max(0px)) {
        .safe-bottom {
          padding-bottom: max(env(safe-area-inset-bottom), 1rem);
        }
        .safe-top {
          padding-top: max(env(safe-area-inset-top), 1rem);
        }
      }

      .checkbox-custom {
        appearance: none;
        width: 22px;
        height: 22px;
        border: 2px solid #d1d5db;
        border-radius: 6px;
        background: white;
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
        position: relative;
      }

      .checkbox-custom:checked {
        background: linear-gradient(135deg, #6d9da3 0%, #528189 100%);
        border-color: #6d9da3;
        box-shadow: 0 0 0 3px rgba(109, 157, 163, 0.15);
      }

      .checkbox-custom:checked::after {
        content: '✓';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 14px;
        font-weight: bold;
      }

      .progress-ring {
        transform: rotate(-90deg);
      }

      .progress-ring-circle {
        transition: stroke-dashoffset 0.5s cubic-bezier(0.16, 1, 0.3, 1);
      }
    </style>
  </head>

  <body class="text-gray-100 font-sans antialiased">
    <div id="root" class="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900"></div>

    <script type="text/babel">
      const { useState, useEffect, useMemo } = React;

      // --- PARSER FIXES ---
      function parseMarkdown(md) {
        const sections = [];
        let currentSection = null;
        let currentSubsection = null;
        let currentRole = "both"; // default role is now "both"
        let currentTime = "";
        let currentDescription = "";
        let currentPriorities = [];

        const lines = md.trim().split("\n");

        for (let i = 0; i < lines.length; i++) {
          const raw = lines[i];
          const line = raw.trim();

          // New section (# ...)
          if (line.startsWith("# ") && !line.startsWith("## ")) {
            if (currentSection) sections.push(currentSection);

            const title = line.replace("# ", "");
            currentSection = {
              id: title.toLowerCase().replace(/[^a-z0-9]+/g, "-"),
              title,
              role: currentRole,
              time: currentTime,
              description: currentDescription,
              priorities: currentPriorities,
              subsections: [],
            };

            currentSubsection = null;
            currentTime = "";
            currentDescription = "";
            currentPriorities = [];
            continue;
          }

          // Time / Role line
          if (line.startsWith("**Time:") || line.startsWith("**Role:")) {
            const timeMatch = line.match(/\*\*Time:\s*(.*?)\*\*/);
            const roleMatch = line.match(/\*\*Role:\s*(.*?)\*\*/);

            if (timeMatch) {
              if (currentSubsection) currentSubsection.time = timeMatch[1].trim();
              else if (currentSection) currentSection.time = timeMatch[1].trim();
            }

            if (roleMatch) {
              if (currentSubsection) currentSubsection.role = roleMatch[1].trim().toLowerCase();
              else if (currentSection) currentSection.role = roleMatch[1].trim().toLowerCase();
            }

            continue;
          }

          // Blockquote lines
          if (line.startsWith("> ")) {
            const text = line.replace(/^>\s*/, "").trim();

            // If it's a note directly under a checklist item
            if (i > 0 && lines[i - 1].trim().startsWith("- [ ]")) {
              const lastItem = currentSubsection?.items?.[currentSubsection.items.length - 1];
              if (lastItem) lastItem.note = text.replace(/^\*|\*$/g, "").trim();
            } else {
              // Otherwise, treat it as a section-level quote
              if (text.startsWith("**Your Priorities:**")) {
                // handled separately
              } else if (text.startsWith("- ")) {
                currentPriorities.push(text);
              } else {
                currentDescription += text + " ";
              }

              if (currentSection) {
                currentSection.description = currentDescription.trim();
                currentSection.priorities = currentPriorities;
              }
            }

            continue;
          }

          // Subsection (## ...)
          if (line.startsWith("## ")) {
            const title = line.replace("## ", "");
            currentSubsection = {
              id: title.toLowerCase().replace(/[^a-z0-9]+/g, "-"),
              title,
              items: [],
            };
            if (currentSection) {
              currentSection.subsections.push(currentSubsection);
            }
            continue;
          }

          // Checklist item
          if (line.startsWith("- [ ]")) {
            const item = parseCheckboxLine(line, i);

            if (currentSubsection) {
              const subItems = [];
              let j = i + 1;

              // look ahead for indented children
              while (
                j < lines.length &&
                lines[j].startsWith("  - [ ]")
              ) {
                subItems.push(parseCheckboxLine(lines[j].trim(), j));
                j++;
              }

              if (subItems.length > 0) {
                item.subItems = subItems;
                i = j - 1; // IMPORTANT: skip those subitems in main loop so we don't duplicate them
              } else {
                item.subItems = null;
              }

              currentSubsection.items.push(item);
            }

            continue;
          }

          // Section break
          if (line === "---") {
            if (currentSection) {
              sections.push(currentSection);
              currentSection = null;
            }
            currentRole = "both";
            currentTime = "";
            currentDescription = "";
            currentPriorities = [];
            continue;
          }
        }

        if (currentSection) sections.push(currentSection);
        return sections;
      }

      function parseCheckboxLine(line, index) {
        const cleanLine = line.replace("- [ ]", "").trim();
        const linkMatch = cleanLine.match(/\[([^\]]+)\]\(([^)]+)\)/);

        let text = cleanLine;
        let link = null;
        let externalLink = null;
        let note = null;
        let warning = false;

        if (linkMatch) {
          const linkText = linkMatch[1];
          const linkUrl = linkMatch[2];
          text = cleanLine.replace(linkMatch[0], linkText);

          if (
            linkUrl.includes("/assets/images/") ||
            linkUrl.match(/\.(jpg|jpeg|png|gif|webp)$/i)
          ) {
            link = linkUrl;
          } else {
            externalLink = linkUrl;
          }
        }

        const noteMatch = text.match(/>\s*\*([^*]+)\*/);
        if (noteMatch) {
          note = noteMatch[1].trim();
          text = text.replace(noteMatch[0], "").trim();
        }

        if (text.includes("⚠️")) {
          warning = true;
        }

        return {
          id: `item-${index}-${Math.random().toString(36).slice(2)}`,
          text: text.replace(/\*\*/g, "").replace(/>/g, "").trim(),
          link,
          externalLink,
          note,
          warning,
        };
      }

      const Lightbox = ({ src, alt, onClose }) => {
        useEffect(() => {
          const handleEscape = (e) => {
            if (e.key === "Escape") onClose();
          };
          document.addEventListener("keydown", handleEscape);
          document.body.style.overflow = "hidden";
          return () => {
            document.removeEventListener("keydown", handleEscape);
            document.body.style.overflow = "";
          };
        }, [onClose]);

        return (
          <div
            className="fixed inset-0 z-[9999] flex items-center justify-center glassmorphism-dark p-4 animate-fade-in"
            onClick={onClose}
          >
            <div
              className="relative max-w-[90vw] max-h-[90vh] animate-scale-in"
              onClick={(e) => e.stopPropagation()}
            >
              <button
                onClick={onClose}
                className="absolute -top-12 right-0 flex h-10 w-10 items-center justify-center rounded-full bg-white/90 hover:bg-white text-gray-800 text-xl font-light shadow-lg transition-all hover:scale-110"
              >
                ×
              </button>
              <img
                src={src}
                alt={alt}
                className="max-h-[90vh] max-w-full rounded-2xl shadow-2xl object-contain"
              />
            </div>
          </div>
        );
      };

      const AVChecklist = () => {
        const [expandedSections, setExpandedSections] = useState({});
        const [checkedItems, setCheckedItems] = useState({});
        const [activeRole, setActiveRole] = useState("sound");
        const [lightboxImage, setLightboxImage] = useState(null);
        const footerRef = React.useRef(null);
        const [isSticky, setIsSticky] = useState(true);
        const [CONTENT, setCONTENT] = useState(null);

        useEffect(() => {
          fetch("./tasks.md")
            .then((res) => res.text())
            .then((text) => setCONTENT(text))
            .catch((err) => {
              console.error("Failed to load tasks.md", err);
              setCONTENT("# Error loading checklist");
            });
        }, []);

        const sections = useMemo(() => {
          if (!CONTENT) return [];
          return parseMarkdown(CONTENT);
        }, [CONTENT]);

        function getVisibleSections(roleFilter = activeRole) {
          return sections.filter(
            (section) =>
              section.role === roleFilter ||
              section.role === "both"
          );
        }

        const visibleItemIds = useMemo(() => {
          const ids = [];
          getVisibleSections().forEach((section) => {
            section.subsections.forEach((subsection) => {
              subsection.items.forEach((item) => {
                // ✅ Only count leaf items (no subItems)
                if (!item.subItems || item.subItems.length === 0) {
                  ids.push(item.id);
                }
                if (item.subItems) {
                  item.subItems.forEach((sub) => ids.push(sub.id));
                }
              });
            });
          });
          return ids;
        }, [activeRole, sections]);

        const totalItems = visibleItemIds.length;
        const checkedCount = useMemo(() => {
          let count = 0;
          for (const id of visibleItemIds) {
            if (checkedItems[id]) count++;
          }
          return count;
        }, [visibleItemIds, checkedItems]);

        const progress = totalItems > 0 ? Math.round((checkedCount / totalItems) * 100) : 0;

        function toggleSection(subsectionId) {
          setExpandedSections((prev) => {
            const isOpen = !!prev[subsectionId];
            return isOpen ? {} : { [subsectionId]: true };
          });
        }

        function toggleItem(itemId) {
          setCheckedItems((prev) => ({
            ...prev,
            [itemId]: !prev[itemId],
          }));
        }

        function roleStyles(role) {
          if (role === "sound") {
            return {
              gradient: "from-grape-400 to-grape-500",
              bg: "bg-grape-50",
              border: "border-grape-300",
              text: "text-grape-700",
              ring: "ring-grape-200/50",
            };
          }
          if (role === "visuals") {
            return {
              gradient: "from-ocean-400 to-ocean-500",
              bg: "bg-ocean-50",
              border: "border-ocean-300",
              text: "text-ocean-700",
              ring: "ring-ocean-200/50",
            };
          }
          // "both" style
          return {
            gradient: "from-amber-400 to-amber-500",
            bg: "bg-amber-50",
            border: "border-amber-300",
            text: "text-amber-700",
            ring: "ring-amber-200/50",
          };
        }

        function renderItem(item, isSubItem = false) {
          const isChecked = !!checkedItems[item.id];

          // If item has subItems but no checkbox text, render as plain label
          if (item.subItems?.length > 0 && !item.text.match(/^-*\[ \]/)) {
            return (
              <div key={item.id} className="ml-1 mt-4">
                <div className="pl-1 pb-1 font-semibold text-gray-800">
                  {item.text}
                </div>
                <div className="mt-2 space-y-2 pl-4 border-l-2 border-gray-200">
                  {item.subItems.map((subItem) => renderItem(subItem, true))}
                </div>
              </div>
            );
          }

          // Normal checklist item
          return (
            <div key={item.id}>
              <label
                className={
                  "group flex items-start gap-3 rounded-xl border bg-white p-4 text-left shadow-sm transition-all duration-200 hover:shadow-md active:scale-[.99] cursor-pointer " +
                  (isSubItem ? "ml-6 mt-3" : "mt-3") +
                  (isChecked
                    ? " border-ocean-200 bg-ocean-50/30"
                    : " border-gray-200 hover:border-gray-300")
                }
              >
                <input
                  type="checkbox"
                  className="checkbox-custom mt-0.5"
                  checked={isChecked}
                  onChange={() => toggleItem(item.id)}
                />

                <div className="flex-1 min-w-0">
                  <div
                    className={
                      "text-base leading-relaxed break-words transition-all " +
                      (isChecked ? "line-through text-gray-400" : "text-gray-800")
                    }
                  >
                    {item.text}
                  </div>

                  {item.warning && (
                    <div className="mt-3 flex items-start gap-2 rounded-lg bg-amber-50 border border-amber-200 p-3">
                      <span className="text-lg">⚠️</span>
                      <span className="text-sm font-medium text-amber-700">
                        Changing gain/EQ affects in-ears – warn band first.
                      </span>
                    </div>
                  )}

                  {item.note && (
                    <div className="mt-2 text-sm text-gray-500 italic leading-relaxed">
                      {item.note}
                    </div>
                  )}

                  {(item.link || item.externalLink) && (
                    <div className="flex flex-wrap gap-2 mt-3">
                      {item.link && (
                        <button
                          onClick={(e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            setLightboxImage(item.link);
                          }}
                          className="inline-flex items-center gap-1.5 rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 hover:shadow transition-all active:scale-95"
                        >
                          <span className="text-base">📷</span>
                          <span>View Image</span>
                        </button>
                      )}

                      {item.externalLink && (
                        <a
                          href={item.externalLink}
                          target="_blank"
                          rel="noopener noreferrer"
                          className="inline-flex items-center gap-1.5 rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-blue-600 shadow-sm hover:bg-blue-50 hover:border-blue-300 hover:shadow transition-all active:scale-95"
                          onClick={(e) => e.stopPropagation()}
                        >
                          <span className="text-base">🔗</span>
                          <span>Open Link</span>
                        </a>
                      )}
                    </div>
                  )}

                </div>
              </label>

              {item.subItems && item.subItems.length > 0 && (
                <div className="ml-6 mt-2 space-y-2 border-l-2 border-gray-200 pl-3">
                  {item.subItems.map((subItem) => renderItem(subItem, true))}
                </div>
              )}
            </div>
          );
        }

        React.useEffect(() => {
          let lastSticky = null;

          function handleScroll() {
            const scrollY = window.scrollY;
            const viewportHeight = window.innerHeight;
            const fullHeight = document.body.offsetHeight;

            const distanceFromBottom = fullHeight - (scrollY + viewportHeight);

            // define buffer zone to prevent rapid toggling
            const shouldBeSticky =
              distanceFromBottom > 180; // stick when more than 180px from bottom

            // only update when state actually changes
            if (shouldBeSticky !== lastSticky) {
              lastSticky = shouldBeSticky;
              setIsSticky(shouldBeSticky);
            }
          }

          window.addEventListener("scroll", handleScroll);
          handleScroll();
          return () => window.removeEventListener("scroll", handleScroll);
        }, []);

        function SubsectionCard({ parentRole, subsection }) {
          const open = !!expandedSections[subsection.id];

          // collect all item IDs (including nested)
          const allIds = [];
          subsection.items.forEach((item) => {
            // Skip parent headers; only count leaf checklist items
            if (!item.subItems || item.subItems.length === 0) {
              allIds.push(item.id);
            }
            if (item.subItems) {
              item.subItems.forEach((si) => allIds.push(si.id));
            }
          });

          const checkedCount = allIds.filter((id) => checkedItems[id]).length;
          const totalCount = allIds.length;
          const complete = totalCount > 0 && checkedCount === totalCount;

          const styles = roleStyles(parentRole);

          return (
            <section className="bg-transparent text-white transition-all duration-300">
              <button
                onClick={() => toggleSection(subsection.id)}
                className="w-full flex items-center justify-between gap-4 py-3 px-4 text-left active:scale-[.99] transition-transform"
              >
                <div className="flex flex-col gap-1 flex-1">
                  <div className="flex items-center flex-wrap gap-2">
                    <h3 className="text-base font-semibold text-white">{subsection.title}</h3>

                    {/* ✅ Mini progress tracker */}
                    {totalCount > 0 && (
                      <span className="rounded-full border border-white/40 bg-white/10 px-2 py-0.5 text-xs font-semibold text-white/90">
                        {checkedCount} / {totalCount}
                      </span>
                    )}

                    {complete && <span className="text-lg">✅</span>}

                    {subsection.time && (
                      <span className="rounded-full border border-white/40 bg-white/10 px-2 py-0.5 text-xs font-semibold text-white/90">
                        ⏱ {subsection.time}
                      </span>
                    )}

                    {subsection.role && (
                      <span className="rounded-full border border-white/40 bg-white/10 px-2 py-0.5 text-xs font-semibold text-white/90">
                        {subsection.role === "both"
                          ? "🤝 Both"
                          : subsection.role === "sound"
                          ? "🎵 Sound"
                          : "📺 Visuals"}
                      </span>
                    )}
                  </div>
                </div>

                <div className="flex items-center gap-2">
                  <p className="text-xs text-white/70 font-medium">
                    {open ? "Tap to collapse" : "Tap to expand"}
                  </p>
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    strokeWidth={2}
                    stroke="currentColor"
                    className={`w-4 h-4 text-white transition-transform duration-300 ${
                      open ? "rotate-180" : ""
                    }`}
                  >
                    <path strokeLinecap="round" strokeLinejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                  </svg>
                </div>
              </button>

              {open && (
                <div
                  className="mt-2 rounded-xl border border-gray-200 bg-white/95 shadow-lg ring-1 ring-black/5 px-4 pb-4 pt-3"
                  style={{ animation: "slide-up 0.25s ease-out 1" }}
                >
                  {subsection.items.map((item) => renderItem(item))}
                </div>
              )}
            </section>
          );
        }

        function SectionHeaderCard({ section, isFirst }) {
          const styles = roleStyles(section.role);

          const textColor =
            section.role === "both"
              ? "text-amber-300"
              : section.role === "sound"
              ? "text-grape-300"
              : section.role === "visuals"
              ? "text-ocean-300"
              : "text-gray-800";

          const borderColor =
            section.role === "both"
              ? "border-amber-400"
              : section.role === "sound"
              ? "border-grape-400"
              : "border-ocean-400";

          return (
            <header className="rounded-2xl overflow-hidden bg-transparent">
              {/* Accent bar (optional, can remove if redundant) */}
              <div className={`h-1 w-full bg-transparent`} />

              <div className="py-3 px-4 space-y-4">
                <div className="flex flex-wrap items-start justify-between gap-3">
                  {/* Title */}
                  <div className="min-w-0 flex-1">
                    <h2
                      className={`text-2xl font-bold leading-tight mb-1 ${textColor}`}
                    >
                      {section.title}
                    </h2>
                  </div>

                  {/* Pills */}
                  <div className="flex shrink-0 flex-row flex-wrap items-center justify-end gap-2">
                    {section.time && (
                      <div
                        className={`rounded-full border-2 ${borderColor} bg-transparent px-3 py-1.5 font-semibold ${textColor} text-xs`}
                      >
                        ⏱ {section.time}
                      </div>
                    )}

                    {section.role && (
                      <div
                        className={`rounded-full border-2 ${borderColor} bg-transparent px-3 py-1.5 font-semibold ${textColor} text-xs`}
                      >
                        {section.role === "both"
                          ? "🤝 Both"
                          : section.role === "sound"
                          ? "🎵 Sound"
                          : "📺 Visuals"}
                      </div>
                    )}
                  </div>
                </div>

                {/* Description */}
                {section.description && (
                  <p className={`text-base leading-relaxed ${textColor}`}>
                    {section.description}
                  </p>
                )}

                {/* Priorities */}
                {section.priorities && section.priorities.length > 0 && (
                  <div className={`rounded-xl border-2 ${borderColor} bg-transparent p-4`}>
                    <p className={`mb-3 text-sm font-bold uppercase tracking-widest flex items-center gap-2 ${textColor}`}>⚠️ Your priorities</p>
                    <ul className="space-y-2">
                      {section.priorities.map((p, i) => (
                        <li
                          key={i}
                          className={`leading-relaxed flex items-start gap-2 ${textColor}`}
                        >
                          <span className="font-bold">•</span>
                          <span>{p.replace(/^-+\s*/, "")}</span>
                        </li>
                      ))}
                    </ul>
                  </div>
                )}
              </div>
            </header>
          );
        }



        return (
          <div className="relative flex min-h-screen flex-col">

            <div className="border-t-8 border-transparent sticky top-0 z-50"
              style={{
                borderImage: "linear-gradient(to right, #9b5de5, #00bbf9, #fee440) 1",
              }}
            />

            <header className="relative w-full bg-white overflow-hidden transition-all">
              <div className="relative mx-auto max-w-2xl px-6 py-36 text-center">
                <h2 className="text-5xl font-extrabold text-gray-900">
                  Tech made{" "}
                  <span className="bg-gradient-to-r from-grape-500 via-ocean-400 to-amber-400 bg-clip-text text-transparent">
                    simple
                  </span>
                </h2>
                <p className="mt-6 text-gray-600 text-xl leading-relaxed mx-auto">
                  Choose your role below, then tick off each step as you go.
                </p>
                <div className="flex items-center justify-center gap-2 transition-all duration-300 mt-6">
                  <button
                    onClick={() => setActiveRole("sound")}
                    className={`rounded-xl border-2 font-semibold px-4 py-1.5 transition-all ${
                      activeRole === "sound"
                        ? "border-grape-400 bg-white text-grape-700 shadow-sm"
                        : "border-gray-300 bg-white text-gray-700 hover:bg-gray-50"
                    }`}
                  >
                    🎵 I'm on sound
                  </button>

                  <button
                    onClick={() => setActiveRole("visuals")}
                    className={`rounded-xl border-2 font-semibold px-4 py-1.5 transition-all ${
                      activeRole === "visuals"
                        ? "border-ocean-400 bg-white text-ocean-700 shadow-sm"
                        : "border-gray-300 bg-white text-gray-700 hover:bg-gray-50"
                    }`}
                  >
                    👨‍💻 I'm on visuals
                  </button>
                </div>
              </div>
            </header>

            <main className="mx-auto w-full max-w-2xl flex-1 px-4 py-6 space-y-6">
              <div className="space-y-12">
                {getVisibleSections().map((section, i) => {
                  const styles = roleStyles(section.role);
                  const borderColor =
                    section.role === "both"
                      ? "border-amber-400"
                      : section.role === "sound"
                      ? "border-grape-400"
                      : "border-ocean-400";

                  return (
                    <div
                      key={section.id}
                      className={`relative space-y-4 animate-slide-up pl-4 border-l-4 ${borderColor}`}
                    >
                      <SectionHeaderCard section={section} isFirst={i === 0} />

                      <div className="space-y-4">
                        {section.subsections.map((subsection, j) => (
                          <React.Fragment key={subsection.id}>
                            <SubsectionCard
                              parentRole={section.role}
                              subsection={subsection}
                              isFirst={j === 0}
                            />
                            {j < section.subsections.length - 1 && (
                              <hr className="border-white/20" />
                            )}
                          </React.Fragment>
                        ))}
                      </div>
                    </div>
                  );
                })}
              </div>


              {progress === 100 && (
                <div className="rounded-2xl border-2 border-ocean-300 bg-gradient-to-br from-ocean-50 to-ocean-100 p-8 text-center shadow-xl animate-scale-in">
                  <div className="text-6xl mb-3">🎉</div>
                  <div className="text-2xl font-bold text-ocean-700 mb-2">
                    All Done!
                  </div>
                  <div className="text-base text-ocean-600 font-medium">
                    You're all set up, great work! 🙌
                  </div>
                </div>
              )}
            </main>

            {lightboxImage && (
              <Lightbox
                src={lightboxImage}
                alt="Reference image"
                onClose={() => setLightboxImage(null)}
              />
            )}

            {Object.values(expandedSections).some(Boolean) && (
              <section
                ref={footerRef}
                className={`pointer-events-none inset-x-0 z-40 flex justify-center safe-bottom transition-all duration-300 ${
                  isSticky ? "fixed bottom-0" : "relative"
                }`}
              >
                <div className="pointer-events-auto w-full max-w-2xl px-4 pb-4">
                  <div className="rounded-2xl border-2 border-ocean-300 bg-gradient-to-br from-ocean-50 to-ocean-100 px-5 py-4 shadow-[0_0_25px_6px_rgba(0,0,0,0.5)]">
                    <div className="flex items-center justify-between gap-4 text-sm">
                      <div className="flex-1 text-center">
                        <div className="text-xs uppercase tracking-wider text-gray-500 font-bold mb-1">
                          Progress
                        </div>
                        <div className="font-bold text-gray-900 text-lg">
                          {checkedCount} / {totalItems}
                        </div>
                      </div>

                      <div className="h-12 w-px bg-gray-300" />

                      <div className="flex-1 text-center">
                        <div className="text-xs uppercase tracking-wider text-gray-500 font-bold mb-1">
                          Your role
                        </div>
                        <div className="font-bold text-gray-900 text-lg">
                          {activeRole === "sound" ? "Sound" : "Visuals"}
                        </div>
                      </div>

                      <div className="h-12 w-px bg-gray-300" />

                      <div className="flex-1 text-center">
                        <div className="text-xs sm:text-sm text-gray-600 leading-snug">
                          <div className="font-medium">Keep calm.</div>
                          <div>You've got this! 🙌</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </section>
            )}

            <footer className="relative w-full bg-gray-50 border-t border-gray-200 text-center text-sm text-gray-600 py-8">
              <p className="font-semibold text-gray-700 mb-1">
                © {new Date().getFullYear()} Vineyard25. All rights reserved.
              </p>
              <p>
                Built with ❤️ by Vineyard25 · Having issues?{" "}
                <a
                  href="mailto:tech@vineyard25.org"
                  className="font-semibold text-ocean-600 hover:underline"
                >
                  tech@vineyard25.org
                </a>
              </p>
            </footer>


          </div>
        );
      };

      ReactDOM.render(<AVChecklist />, document.getElementById("root"));
    </script>
  </body>
</html>